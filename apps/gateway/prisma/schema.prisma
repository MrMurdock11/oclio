generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_CONNECTION_STRING")
}

model User {
  id             BigInt         @id @default(autoincrement())
  fullName       String         @map("full_name") @db.VarChar(95)
  bio            String?
  email          String         @unique @db.VarChar(256)
  hashedPassword String         @map("hashed_password") @db.VarChar(72)
  preferences    Json           @default("{}")
  subscribers    Subscription[] @relation("subscriber_subscriptions")
  subscriptions  Subscription[] @relation("user_subscriptions")

  @@map("users")
}

model Subscription {
  id           BigInt   @id @default(autoincrement())
  userId       BigInt   @map("user_id")
  subscriberId BigInt   @map("subscriber_id")
  subscribeAt  DateTime @default(now()) @map("subscribe_at")
  subscriber   User     @relation("subscriber_subscriptions", fields: [subscriberId], references: [id])
  user         User     @relation("user_subscriptions", fields: [userId], references: [id])

  @@unique([userId, subscriberId])
  @@map("subscriptions")
}
